import{a as R,b as B}from"/dist/c/c-22G3WVOS.js";import{a as U}from"/dist/c/c-XRELKHNC.js";import{a as b}from"/dist/c/c-S4L463HQ.js";import{b as O,c as j,h as I,i as H}from"/dist/c/c-XDH7PMHB.js";import{a as D,b as L}from"/dist/c/c-EDSRUMH6.js";import"/dist/c/c-KSSOJZ3C.js";import"/dist/c/c-NYNQODKR.js";import"/dist/c/c-Z2VP4VCE.js";import"/dist/c/c-YFJRUNOO.js";import"/dist/c/c-YVETZ4Y2.js";import"/dist/c/c-5XZKAQNH.js";import"/dist/c/c-GJIO3EWD.js";import"/dist/c/c-NENNBZMZ.js";import"/dist/c/c-CLY6UUDX.js";import"/dist/c/c-7OAKJDUS.js";import"/dist/c/c-Q7L6TC6B.js";import"/dist/c/c-POUJ35QD.js";import"/dist/c/c-NFJ4PGVD.js";import"/dist/c/c-X3IXKJUF.js";import"/dist/c/c-Q7JB42OK.js";import"/dist/c/c-CCCQQLS7.js";import"/dist/c/c-RFMEDZC2.js";import"/dist/c/c-DDUQR2DR.js";import"/dist/c/c-MSBTLOXM.js";import"/dist/c/c-ERSFEUJG.js";import"/dist/c/c-XA4YTUEK.js";import"/dist/c/c-SDFKBX5K.js";import"/dist/c/c-CXFUNZH6.js";import{q as W,r as S}from"/dist/c/c-SEXQVNXD.js";import"/dist/c/c-CCLRE5PE.js";import"/dist/c/c-6V26Y4N6.js";import{q as $,r as V}from"/dist/c/c-YWMSYINN.js";import"/dist/c/c-C63XTUXK.js";import{a as A}from"/dist/c/c-MTEWFZUN.js";import"/dist/c/c-HMG3J5I6.js";import"/dist/c/c-UV2AUEPO.js";import"/dist/c/c-ZICVJFZS.js";import"/dist/c/c-UKX3XYO7.js";import"/dist/c/c-QURGWM6Y.js";import"/dist/c/c-DHW7ZCWP.js";import"/dist/c/c-ELKS2YNU.js";import"/dist/c/c-DM5RC5UP.js";import"/dist/c/c-CZDWWIWZ.js";import"/dist/c/c-6VKWMR33.js";import"/dist/c/c-SMKXZXXM.js";import"/dist/c/c-NPM6MT5S.js";import"/dist/c/c-3JZSAYWT.js";import"/dist/c/c-IG4XOXEB.js";import"/dist/c/c-OHFRQC2M.js";import{c as G}from"/dist/c/c-U2FTHHN5.js";import{a as F}from"/dist/c/c-UEIEIK52.js";import{b as M}from"/dist/c/c-2IW6BEWA.js";import"/dist/c/c-BYDCJ7X5.js";import{c as _,d as E}from"/dist/c/c-CSPQ5T3S.js";import{d as x}from"/dist/c/c-TAHBUCPV.js";var h=x(F()),p=x(M());V();j();L();H();E();S();G();var y=x(A()),z=b.extend(D.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH_FOR_FULLSCREEN:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,TIP_GAP_FOR_WIDGET_WITHOUT_FREE_POSITION:15,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){this.updateCurrentWidgetData();let t;if(this.makeBox("widget-hotspot"),this.$pinIcons={default:null,onClick:null},this.rendered=!0,this.phoneTipWrapperTemplate=O["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!!(RM.constructorRouter&&RM.constructorRouter.preview),this.useFreePosition=this.flags?.tipFreePosition||!1,t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new I(t),this.$pin=this.$(".pin").addClass("viewer"),this.cursorStyle&&this.$pin.css("cursor",this.cursorStyle),this.started&&this.renderTip(),this.widget.pinPosRelativeTip==="above"&&this.$pin.css("z-index",3),this.widget.pin_type==="icon"){if(this.$el.addClass("icon"),!this.widget.rasterUrl&&!this.widget.b64url)return this.widgetIsLoaded(),this;let i=(0,h.default)("<img>");i.on("load",p.default.bind(function(){this.$pin.append(i),this.$pinIcons.default=i,this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded),i.attr("src",this.widget.raster3xUrl||this.widget.raster2xUrl||this.widget.rasterUrl||this.widget.b64url||""),i.addClass("contain")}else this.renderPinShape(),this.widgetIsLoaded();if(this.checkShouldRenderOnClickPinIcon())if((this.widget.clickPinType||this.widget.pin_type)==="icon"){let o={};this.widget.clickRaster3xUrl||this.widget.clickRaster2xUrl||this.widget.clickRasterUrl||this.widget.clickB64url?o={raster3xUrl:this.widget.clickRaster3xUrl,raster2xUrl:this.widget.clickRaster2xUrl,rasterUrl:this.widget.clickRasterUrl,b64url:this.widget.clickB64url}:o={raster3xUrl:this.widget.raster3xUrl,raster2xUrl:this.widget.raster2xUrl,rasterUrl:this.widget.rasterUrl,b64url:this.widget.b64url};let s=(0,h.default)("<img>");s.css("display","none"),s.addClass("contain"),s.on("load",p.default.bind(function(){this.$pin.append(s),this.$pinIcons.onClick=s},this)),s.attr("src",o.raster3xUrl||o.raster2xUrl||o.rasterUrl||o.b64url||"")}else this.renderPinShapeForOnClick();else return this;return this},deleteUnusedDataFromContext:function(){delete this.pin_type,delete this.raster3xUrl,delete this.raster2xUrl,delete this.rasterUrl,delete this.b64url,delete this.clickPinType,delete this.clickRaster3xUrl,delete this.clickRaster2xUrl,delete this.clickRasterUrl,delete this.clickB64url,delete this.tipBorder,delete this.tipBorderColor,delete this.tipBorderOpacity,delete this.pinPosRelativeTip},updateCurrentWidgetData:function(){let t=this.page?.mag?.viewport||"default",e=t!=="default"?this.currentWidgetData[`viewport_${t}`]:void 0,i=e?{...this.currentWidgetData,...e}:this.currentWidgetData;this.widget=i||this,this.deleteUnusedDataFromContext()},checkShouldRenderOnClickPinIcon:function(){let t={pinType:this.widget.clickPinType||this.widget.pin_type,raster3xUrl:this.widget.clickRaster3xUrl||this.widget.raster3xUrl,raster2xUrl:this.widget.clickRaster2xUrl||this.widget.raster2xUrl,rasterUrl:this.widget.clickRasterUrl||this.widget.rasterUrl,b64url:this.widget.clickB64url||this.widget.b64url,bg_color:this.clickBgColor||this.bg_color,bg_opacity:this.clickBgOpacity||this.bg_opacity,borders:this.clickBorders||this.borders,color:this.clickColor||this.color,opacity:this.clickOpacity||this.opacity};return t.pinType===this.widget.pin_type&&t.raster3xUrl===this.widget.raster3xUrl&&t.raster2xUrl===this.widget.raster2xUrl&&t.rasterUrl===this.widget.rasterUrl&&t.b64url===this.widget.b64url&&t.clickBgColor===this.bg_color&&t.clickBgOpacity===this.bg_opacity&&t.clickBorders===this.borders&&t.clickColor===this.color&&t.clickOpacity===this.opacity?!1:!this.isHoverable()},togglePinIcon:function(){let t=!this.isHoverable()&&this.isTipVisible===!0;this.checkShouldRenderOnClickPinIcon()&&(t?this.$pinIcons.onClick&&(this.$pinIcons.onClick.css("display","block"),this.$pinIcons.default&&this.$pinIcons.default.css("display","none")):this.$pinIcons.default&&(this.$pinIcons.default.css("display","block"),this.$pinIcons.onClick&&this.$pinIcons.onClick.css("display","none")))},renderPinShape:function(){let t=new y.default.Model(this);t.id=this._id;let e=(0,h.default)(this.generateShapeSVG("viewer",t,this.w,this.h,this.widget.pin_type));this.$pinIcons.default=e,this.$pin.append(e)},renderPinShapeForOnClick:function(){let t=new y.default.Model(this);t.id=this._id;let e={bg_color:this.clickBgColor||this.bg_color,bg_opacity:this.clickBgOpacity||this.bg_opacity,borders:this.clickBorders||this.borders,color:this.clickColor||this.color,opacity:this.clickOpacity||this.opacity,pin_type:this.widget.clickPinType||this.widget.pin_type,addToCaller:"click"},i=(0,h.default)(this.generateShapeSVG("viewer",t,this.w,this.h,e.pin_type,e));i.css("display","none"),this.$pinIcons.onClick=i,this.$pin.append(i)},renderTip:function(){let t=this.page?.mag?.viewport||"default";if(!this.isTipRendered){if(this.$tip=(0,h.default)('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=(0,h.default)('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":$.getRGBA(this["tip_background-color"]||"",(this["tip_background-color-opacity"]??100)/100),"border-radius":this["tip_border-radius"]}),this.widget.tipBorder&&this.widget.tipBorderColor&&this.widget.tipBorderOpacity&&(this.$borderWrapper=(0,h.default)('<div class="border-wrapper"></div>'),this.$borderWrapper.appendTo(this.$tip),this.$borderWrapper.css({border:`${this.widget.tipBorder}px solid ${$.getRGBA(this.widget.tipBorderColor||"",(this.widget.tipBorderOpacity??100)/100)}`,position:"absolute",width:"100%",height:"100%","box-sizing":"border-box",top:"0",left:"0","border-radius":this["tip_border-radius"]})),this.$(".common-hotspot").append(this.$tip),this.pictureData=p.default.findWhere(this.wids||[],{type:"picture"}),this.textData=p.default.findWhere(this.wids||[],{type:"text"}),t!=="default"&&(this.pictureData&&(this.pictureData={...this.pictureData,...this.pictureData[`viewport_${t}`]}),this.textData&&this.textData[`viewport_${t}`])){let e=this.textData[`viewport_${t}`],i={},o=["blocks"];for(let s in e)e.hasOwnProperty(s)&&(o.includes(s)||(i[s]=e[s]));this.textData={...this.textData,...i}}if(this.blocks=[],this.hasPictureWidget=!!(this.pictureData&&!this.pictureData.hidden),this.hasTextWidget=!!(this.textData&&!this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureData.useFreePosition=this.useFreePosition,this.pictureWidget=new U(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.blocks.push(this.pictureWidget),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textData.useFreePosition=this.useFreePosition,this.textData.hasGlobalParent=this.is_global,this.textData.version===3?this.textWidget=new B({...this.textData,is_above:this.is_above,is_global:this.is_global},this.page,this.$blocksWrapper):this.textWidget=new R(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.blocks.push(this.textWidget),this.textWidget.render()),!this.hasPictureWidget&&!this.hasTextWidget){this.blocks=[],this.$tip.remove();return}this.$closeButton=(0,h.default)('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0}},updatePage:function(t){b.prototype.updatePage.apply(this,arguments),this.textWidget&&this.textWidget.updatePage(t)},start:function(){return b.prototype.start.call(this),this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return b.prototype.stop.call(this),this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){if(this.useFreePosition)this.hotspotWidget.apply_tip_position({y:this.y,x:this.x,tip_y:this.tip_y,tip_x:this.tip_x,flags:this.flags,fixed_position:this.fixed_position});else{let T=function(l){let a,u,c,g;switch(l){case"top":a=i.top-s.h/2-n-r.h,c=i.bottom+s.h/2+n,g=i.left-r.w/2,u=i.right-r.w/2;break;case"right":a=i.top-r.h/2,c=i.bottom-r.h/2,g=i.left+s.w/2+n,u=i.right-s.w/2-n-r.w;break;case"bottom":a=i.bottom+s.h/2+n,c=i.bottom-s.h/2-n-r.h,g=i.left-r.w/2,u=i.right-r.w/2;break;case"left":a=i.top-r.h/2,c=i.bottom-r.h/2,g=i.left-s.w/2-n-r.w,u=i.right+s.w/2+n;break}return{top:a,left:g,bottom:c,right:u}},P=function(l){let a=l,u=-1/0,c,g=!1;return p.default.each(["top","right","bottom","left"],function(m){if(g)return;let k=T(m);c=p.default.min(k),m===l&&k[m]>0?(a=m,g=!0):c>u&&k[m]>=0&&(u=c,a=m)}),a};var t=T,e=P;let i=this.calcDistsToPageVisibleBounds(),o,s={w:this.w,h:this.h},r={w:this.$tip.width(),h:this.$tip.height()},n=this.TIP_GAP_FOR_WIDGET_WITHOUT_FREE_POSITION,d=this.tip_pos,w=p.default.pick(this,"w","h","tip_w","tip_h","tip_pos"),f,C=!1,v=!1;d=P(this.tip_pos),w.tip_pos=d,f=this.hotspotWidget.apply_tip_position(w),o=T(d),p.default.each(o,function(l,a){if(l<0)switch(a){case"top":f.top-=l-this.EDGE_GAP,C=!0;break;case"bottom":C||(f.top+=l-this.EDGE_GAP);break;case"left":f.left-=l-this.EDGE_GAP,v=!0;break;case"right":v||(f.left+=l-this.EDGE_GAP);break}}.bind(this)),this.$tip.css(f)}},adjustPictureSize:function(){let t=this.tip_w/this.PHONE_TIP_WIDTH_FOR_FULLSCREEN,e;this.pictureWidget&&(this.isPhone()?e={width:this.PHONE_TIP_WIDTH_FOR_FULLSCREEN,height:this.pictureData.h/t}:e={width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(e))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),RM.analytics&&this.isTipVisible&&RM.analytics.sendEvent("rm_hotspot_click",this._id))},onMouseenter:function(){!this.isHoverable()||!this.isTipRendered||(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),RM.analytics&&RM.analytics.sendEvent("rm_hotspot_hover",this._id))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},swapBlocks:function(t,e){let i=(0,h.default)("<span />").css({display:"none"});i.insertBefore(t),t.insertAfter(e),e.insertAfter(i),i.remove()},bringToTopZ:function(){let t=this.is_above?this.mag.aboveGlobalWidgets:this.page.widgets,e=!!this.fixed_position,i=this.$el.css("z-index"),o=null,s=t.reduce((r,n)=>{if(e&&n.fixed_position||!e&&!n.fixed_position){let d=n?.$el&&!Number.isNaN(n.$el.css("z-index"))?n.$el.css("z-index"):-1/0;if(r<d&&n.type!=="background")return o=n,d}return r},i);if(o){let r=this.$el,n=o.$el;this.animationObj&&(r=this.animationObj.getAnimationContainer(),this.animationObj.resetTimeout&&clearTimeout(this.animationObj.resetTimeout),this.animationObj.savedAnimationContainerZIndex||(this.animationObj.savedAnimationContainerZIndex=r.css("z-index")),r.css("z-index",s)),o.animationObj&&(n=o.animationObj.getAnimationContainer()),r.nextAll().is(n)&&(this.$tempMaxZIndexElement=n,this.swapBlocks(r,n))}this.$el.css("z-index",s)},backToNormalZ:function(){if(this.$tempMaxZIndexElement){let t=this.$el;this.animationObj&&this.animationObj.savedAnimationContainerZIndex&&(t=this.animationObj.getAnimationContainer(),this.animationObj.resetTimeout&&clearTimeout(this.animationObj.resetTimeout),this.animationObj.resetTimeout=setTimeout(()=>{this.animationObj&&this.animationObj.savedAnimationContainerZIndex&&(t.css("z-index",this.animationObj.savedAnimationContainerZIndex||this.z),delete this.animationObj.savedAnimationContainerZIndex),delete this.animationObj.resetTimeout},200)),this.swapBlocks(t,this.$tempMaxZIndexElement),this.$tempMaxZIndexElement=null}this.$el.css("z-index",this.z)},showTip:function(){if(!this.isTipRendered)return;let t=this["tip_box-fullscreen"]!==void 0?this["tip_box-fullscreen"]:this.isPhone();if(this.isPhone()&&(t||!this.useFreePosition)){this.adjustPictureSize(),this.$phoneTipWrapper=this.$phoneTipWrapper||(0,h.default)(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent(),this.$tipContainer=this.$phoneTipWrapper.find(".center-cell"),this.$tip.detach().appendTo(this.$tipContainer);let e=this.mag.getScale(this.page.pageViewport);this.$tip.css({transform:`scale(${e})`});let i=W.mapElementToViewport(this.$tip[0],e,1);this.$tipContainer.css({height:i.height}),p.default.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(o){let s=(0,h.default)(o.target).closest("a");if(!s)return;let r=s.hasClass("external-link"),n=s.hasClass("close-tip-on-click"),d=s.hasClass("current"),w=this.$tipContainer.is((0,h.default)(o.target));if(r||o.preventDefault(),n||d||w){this.hideTip(),this.$phoneTipWrapper.off();return}}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)}else this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.bringToTopZ(),this.page.mag.$container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||(0,h.default)("body").on("keydown",this.onBodyKeyDown);this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.blocks?.forEach(e=>{e?.$el.on("click",this.onTipLinkClick)}),this.isTipVisible=!0,this.togglePinIcon()},hideTip:function(){if(!this.isTipVisible)return;let t=this["tip_box-fullscreen"]!==void 0?this["tip_box-fullscreen"]:this.isPhone();this.isTipVisible=!1,this.togglePinIcon(),clearTimeout(this.mouseLeaveTimeout),this.isPhone()&&(t||t===void 0||!this.useFreePosition)?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),p.default.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),this.backToNormalZ(),(0,h.default)("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"),this.blocks?.forEach(e=>{e?.$el.off("click",this.onTipLinkClick)})},onTipLinkClick:function(t){let e=(0,h.default)(t.currentTarget),i=e.parent().hasClass("close-tip-on-click"),o=e.hasClass("close-tip-on-click"),s=!!e.find(".close-tip-on-click")?.length;(i||o||s)&&this.hideTip()},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();let e=(0,h.default)(t.currentTarget),i=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(i<0&&e.scrollTop()<=0||i>0&&e.scrollTop()+e.height()>=e[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(){this.hideTip()},onGlobalMouseDown:function(t){let e=(0,h.default)(t.target),i=e.closest(".pin"),o=e.closest(".tip");i.is(this.$pin)||o.is(this.$tip)||(this.page.mag.$container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return _.isMobile()||this.isPreview&&this.page.mag.viewport==="phone_portrait"},isHoverable:function(){return this.tip_show_on==="hover"&&_.isDesktop()&&!this.isPhone()&&this.page.mag.viewport!=="tablet_portrait"},onBodyKeyDown:function(t){t.keyCode===h.default.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,this.isTipRendered=!1,b.prototype.destroy.apply(this,arguments)}}),ot=z;export{ot as default};
