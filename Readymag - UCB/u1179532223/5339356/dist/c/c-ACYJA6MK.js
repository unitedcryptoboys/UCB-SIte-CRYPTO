import{I as S,J as V}from"/u1179532223/5339356/dist/c/c-ZCDN2C4Y.js";import{a as M,b as h,l as U,o as v,p as F,q as m,r as O}from"/u1179532223/5339356/dist/c/c-YWMSYINN.js";import{a as r,b as a,c as D,d as p,e as E,f as k,g as A}from"/u1179532223/5339356/dist/c/c-C63XTUXK.js";import{a as T}from"/u1179532223/5339356/dist/c/c-MTEWFZUN.js";import{b as n,c as g}from"/u1179532223/5339356/dist/c/c-OHFRQC2M.js";import{a as x}from"/u1179532223/5339356/dist/c/c-UEIEIK52.js";import{b as f}from"/u1179532223/5339356/dist/c/c-2IW6BEWA.js";import{d as u}from"/u1179532223/5339356/dist/c/c-TAHBUCPV.js";var o=u(f()),C=u(T());g();var b=u(x()),c=u(f());O();g();U();V();A();var H={initialize:function(t){c.default.bindAll(this),c.default.extend(this,t),this.currentData=this._initCurrentData(),window.gtag&&this.currentData.userId&&!window.RM.common.isDownloadedSource&&window.gtag("set",{user_id:this.currentData.userId}),(0,b.default)(c.default.bind(function(){this.initialTracking()},this))},initialTracking(){let t=r("_rm_reg_cookie"),e=r("_rm_join_analytics_data");this.trackPage(),t&&(a("_rm_reg_cookie"),h.sendConversionEvent({CONVERSION_ID:n.GOOGLE_ADS_ID,CONVERSION_LABEL:n.GOOGLE_CONVERSION_LABEL_REGISTRATION,value:15,transaction_id:"",...this.currentData.userEmail&&{user_data:{email:this.currentData.userEmail}}}),h.sendEventToLinkedInInsights({partnerId:n.linkedInPartnerId,eventId:M.Registration})),e&&a("_rm_join_analytics_data")},sendEvent:function(t,e){if(!window.gtag||RM.constructorRouter&&RM.constructorRouter.previewMode)return;let i={};c.default.isObject(e)?i=c.default.extend(i,e):i.rm_parameter=e||void 0,window.gtag("event",t,{userId:this.currentData.userId,campaign:{name:this._rmdata?.first_campaign,source:this._rmdata?.first_source,medium:this._rmdata?.first_medium},c_id:this.currentData.gacid,rm_parameter:i.rm_parameter})},trackPage:function(){if(!window.gtag||RM.constructorRouter&&RM.constructorRouter.previewMode||S())return;let t=new Date().toISOString().slice(0,10),e=`page_view_last_${this.currentData.userId}`;localStorage.getItem(e)!==t&&(window.gtag("event","page_view",{userId:this.currentData.userId,campaign:{name:this._rmdata?.first_campaign,source:this._rmdata?.first_source,medium:this._rmdata?.first_medium},c_id:this.currentData.gacid}),localStorage.setItem(e,t))},_initCurrentData:function(){let t={};t.userId=null,window.ServerData.me&&(t.userId=window.ServerData.me._id||window.ServerData.me.user&&window.ServerData.me.user._id,t.userEmail=window.ServerData.me.email||window.ServerData.me.user&&window.ServerData.me.user.email),t.gacid=m.getGAcid();let e=r("_rmdata");return e&&(this._rmdata=JSON.parse(atob(e))),t}},R=H;var L={},y=L;var l=u(f());O();F();A();g();var j={initialize:function(t){l.default.bindAll(this),l.default.extend(this,t),this.shortlink_redirect=r("shortlink_redirect"),this.initialTracking(),this.ecommerceEvents=["add_to_cart","view_cart","remove_from_cart","begin_checkout","purchase"]},setClientIdFromCookie:function(){let t=r("_ga");if(t){let e=t.match(/GA[0-9]+\.[0-9]+\.(.*)/);this.clientId=e.length>1?e[1]:void 0,this.clientId&&window.gtag("set",{client_id:this.clientId})}},sendEvent:function(t,e){if(!window.gtag)return;if(!RM.common.isDomainViewer){let d=window.ServerData&&!window.ServerData.isCountryInEU&&window.Cookiebot&&!window.Cookiebot.declined,P=window.Cookiebot&&(window.Cookiebot.consent.statistics||window.Cookiebot.consented===!1&&window.Cookiebot.declined===!1);if(window.ServerData&&window.ServerData.isCountryInEU){if(!P&&!RM.common.isDomainViewer)return}else if(!d&&!RM.common.isDomainViewer)return}this.setClientIdFromCookie();let i={};l.default.isObject(e)?(i.rm_parameter=e.parameter,i.ecommerceData=e.ecommerceData):i.rm_parameter=e;let _=["https://readymag.com/websites-of-the-year/","https://readymag.com/designlayers/"],w=RM.common.isProjectOwnedByRM&&_.includes(window.location.href);if(RM.common.readymagTracker&&RM.common.isProjectOwnedByRM&&!this.ecommerceEvents.includes(t)||w){let d={userId:this.userId,firstCampaign:this._rmdata&&this._rmdata.first_campaign,firstMedium:this._rmdata&&this._rmdata.first_medium,campaign:{name:this._rmdata&&this._rmdata.first_campaign,source:this._rmdata&&this._rmdata.first_source,medium:this._rmdata&&this._rmdata.first_medium},c_id:this.clientId,rm_parameter:i.rm_parameter};window.gtag("event",t,d)}if(RM.common.userTracker&&!RM.common.homepageRewrite){let d={rm_parameter:i.rm_parameter,...i.ecommerceData?i.ecommerceData:void 0};window.gtag("event",t,d)}},trackPage:function(){if(!window.gtag)return;this.setClientIdFromCookie();let t=()=>{if(RM.common.readymagTracker&&RM.common.isProjectOwnedByRM){let e=window.location.pathname==="/"||window.location.pathname==="",i=r("_rm_homepage_ab_test"),_=r("_rm_homepage_ab_test_sent");window.gtag("event","page_view",{userId:this.userId,firstCampaign:this._rmdata&&this._rmdata.first_campaign,firstMedium:this._rmdata&&this._rmdata.first_medium,campaign:{name:this._rmdata&&this._rmdata.first_campaign,source:this._rmdata&&this._rmdata.first_source,medium:this._rmdata&&this._rmdata.first_medium},c_id:this.clientId}),e&&i&&!_&&(window.gtag("event","ab_experiment_mainpage",{group:i,experiment_name:"aa_test_iteration"}),D("_rm_homepage_ab_test_sent","1",30))}RM.common.userTracker&&window.gtag("event","page_view")};RM.common.readymagTracker&&RM.common.isProjectOwnedByRM&&(m.initLinkedInInsights(),m.trackPixelPageView(),m.trackTiktokPixelView()),window.gtagConfigReady?t():window.addEventListener("gtagConfigReady",()=>{t()},{once:!0})},_processRedirectUTM:function(){if(!this.shortlink_redirect)return;let t=JSON.parse(atob(this.shortlink_redirect));return a("shortlink_redirect"),{campaignName:t.utm_campaign,campaignSource:t.utm_source,campaignMedium:t.utm_medium}},initialTracking:function(){let t=window.ServerData.isCountryInEU;E(),t||(this._rmdata=p(),k()),RM.common.isDomainViewer?this.trackPage():m.loadLoggedUser(e=>{let i=!1,_=()=>{t&&k(),e&&e._id&&(this.userId=e._id,window.gtag&&window.gtag("set",{user_id:e._id}),window?.amplitude?.setUserId(e._id),r("_rm_amp_data")&&a("_rm_amp_data"))},w=()=>{i||(i=!0,_(),this.trackPage())};!t&&window.Cookiebot&&window.Cookiebot.declined===!1&&w(),v.waitForCookieConsent().then(d=>{if(!d.statistics){a("_rmdata"),a("_rm_amp_data"),a(n.FIRSTPROMOTER_COOKIE_KEY),a(n.FIRSTPROMOTER_REF_COOKIE_KEY);return}w(),d.marketing&&t&&(this._rmdata=p())})})}},I=j;var s={};if(typeof window<"u"){if(location.origin===n.readymag_auth_host&&R?s=C.default.Model.extend(o.default.extend(o.default.extend(s,R),y)):I?s=C.default.Model.extend(o.default.extend(o.default.extend(s,I),y)):console.error("Analytics initialization error!"),window.RM&&window.RM.customAnalyticsHandlers&&!o.default.isEmpty(window.RM.customAnalyticsHandlers.event)){let t=s.prototype.sendEvent;s.prototype.sendEvent=function(){if(!window.ga)return;let e=t.apply(this,arguments);return window.RM.customAnalyticsHandlers&&o.default.isFunction(window.RM.customAnalyticsHandlers.run)&&window.RM.customAnalyticsHandlers.run("event",e),e}}if(window.RM&&window.RM.customAnalyticsHandlers&&!o.default.isEmpty(window.RM.customAnalyticsHandlers.track)){let t=s.prototype.trackPage;s.prototype.trackPage=function(){if(!window.ga)return;let e=t.apply(this,arguments);return e&&window.RM.customAnalyticsHandlers&&o.default.isFunction(window.RM.customAnalyticsHandlers.run)&&window.RM.customAnalyticsHandlers.run("track",e),e}}}var rt=s;export{rt as a};
